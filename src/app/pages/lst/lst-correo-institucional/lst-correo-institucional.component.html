<div class="container my-5">
  <div class="card shadow-lg border-0 rounded-4 overflow-hidden">
    <!-- HEADER -->
    <div
      class="card-header text-white d-flex justify-content-between align-items-center rounded-top"
      style="
        background: linear-gradient(90deg, #0a4aa1, #0d6efd);
        border-bottom: 4px solid #ff9800;
      "
    >
      <h4 class="m-0 d-flex align-items-center">
        <i class="bi bi-envelope-fill me-2"></i>
        Lista de Correos Institucionales
      </h4>
    </div>

    <!-- FILTRO -->
    <div class="card-body bg-light">
      <div
        class="d-flex flex-wrap justify-content-between align-items-center mb-4 gap-3 w-100"
      >
        <app-fil-correos-institucionales
          (emmit)="doFound($event)"
          class="flex-grow-1"
        ></app-fil-correos-institucionales>
      </div>

      <!-- LISTADO -->
      <div class="table-responsive rounded-4 shadow-sm bg-white">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-primary text-center">
            <tr>
              <th>Nombre</th>
              <th>Apellido</th>
              <th>DNI</th>
              <th>Jerarquía</th>
              <th>Unidad</th>
              <th>Correo</th>
              <th>Contraseña</th>
              <th>Tipo</th>
              <th>Habilitación</th>
              <th>Notificación</th>
              <th>¿Acta recibida?</th>
              <th class="text-center">Acciones</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let item of items; index as i">
              <td>{{ item.nombre }}</td>
              <td>{{ item.apellido }}</td>
              <td>{{ item.dni }}</td>
              <td>{{ item.jerarquia }}</td>
              <td>{{ item.unidad }}</td>
              <td>{{ item.correoInstitucional }}</td>

              <!-- CONTRASEÑA SEGÚN ROL -->
              <td>
                <ng-container *ngIf="rol === 'MANAGER'; else oculto">
                  <span class="text-primary fw-semibold">{{
                    item.contrasenia
                  }}</span>
                </ng-container>

                <ng-template #oculto>
                  <span class="text-muted fst-italic">******</span>
                </ng-template>
              </td>

              <!-- TIPO -->
              <td class="text-center">
                <span
                  class="badge px-3 py-2 text-white fw-semibold"
                  [style.background-color]="
                    item.tipoCorreo === 'Personal Institucional'
                      ? '#198754'
                      : '#0d6efd'
                  "
                  style="border-radius: 12px"
                >
                  <i
                    class="bi"
                    [ngClass]="{
                      'bi-person-badge':
                        item.tipoCorreo === 'Personal Institucional',
                      'bi-building':
                        item.tipoCorreo === 'Institucional Dependencia'
                    }"
                  ></i>
                  {{ " " + item.tipoCorreo }}
                </span>
              </td>

              <!-- HABILITADO -->
              <td
                class="text-center fw-semibold"
                [ngClass]="{
                  'text-success': item.fechaHabilitacion,
                  'text-warning': !item.fechaHabilitacion
                }"
              >
                {{
                  item.fechaHabilitacion
                    ? (item.fechaHabilitacion | date : "dd/MM/yyyy")
                    : "No fue habilitado"
                }}
              </td>

              <!-- NOTIFICADO -->
              <td
                class="text-center fw-semibold"
                [ngClass]="{
                  'text-info': item.fechaNotificacion,
                  'text-danger': !item.fechaNotificacion
                }"
              >
                {{
                  item.fechaNotificacion
                    ? (item.fechaNotificacion | date : "dd/MM/yyyy")
                    : "No fue notificado"
                }}
              </td>

              <td class="text-center">
                <span
                  class="badge px-3 py-2"
                  [class.bg-success]="item.actaRecibida"
                  [class.bg-danger]="!item.actaRecibida"
                >
                  {{ item.actaRecibida ? "Sí" : "No" }}
                </span>
              </td>

              <!-- ACCIONES -->
              <td class="text-center">
                <!-- DETALLE -->
                <button
                  class="btn btn-sm btn-outline-primary rounded-pill me-2 px-3"
                  title="Agregar detalle"
                  (click)="abrirModalDetalle(item)"
                >
                  <i class="bi bi-journal-text"></i>
                </button>

                <!-- PLATAFORMA -->
                <button
                  class="btn btn-sm rounded-pill px-3"
                  style="background-color: #0d6efd; color: white"
                  title="Plataforma"
                  *ngIf="item.tipoCorreo !== 'Institucional Dependencia'"
                  (click)="linkear(item.idCorreo)"
                >
                  <i class="bi bi-hdd-network"></i>
                </button>
              </td>
            </tr>

            <!-- SIN REGISTROS -->
            <!-- SIN REGISTROS -->
            <tr *ngIf="items.length === 0">
              <td colspan="12" class="py-5">
                <div
                  class="d-flex flex-column align-items-center text-secondary"
                >
                  <div
                    class="rounded-circle mb-3 d-flex justify-content-center align-items-center"
                    style="
                      width: 70px;
                      height: 70px;
                      background: rgba(13, 110, 253, 0.1);
                      border: 2px dashed #0d6efd;
                    "
                  >
                    <i class="bi bi-inbox fs-1 text-primary"></i>
                  </div>

                  <h5 class="fw-semibold mb-1">Sin resultados</h5>
                  <p class="text-muted m-0">
                    No hay correos registrados para mostrar.
                  </p>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- FOOTER -->
    <div
      class="card-footer text-end text-muted small bg-white border-top fw-semibold"
    >
      Total: {{ items.length }} registros
    </div>
  </div>
</div>

<!-- MODAL DETALLE -->
<div
  class="modal fade"
  id="modalDetalle"
  tabindex="-1"
  aria-labelledby="modalDetalleLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-md">
    <div class="modal-content rounded-4 border-0 shadow-lg">
      <!-- HEADER -->
      <div class="modal-header bg-primary text-white rounded-top">
        <h5 class="modal-title" id="modalDetalleLabel">
          <i class="bi bi-file-earmark-text-fill me-2"></i> Nuevo Detalle de
          Acta
        </h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
          aria-label="Cerrar"
        ></button>
      </div>

      <!-- BODY -->
      <form
        class="needs-validation"
        novalidate
        (ngSubmit)="crearDetalle()"
        #formDetalle="ngForm"
      >
        <div class="modal-body bg-light">
          <div class="form-check form-switch mb-3">
            <input
              class="form-check-input"
              type="checkbox"
              role="switch"
              id="actaRecibida"
              [(ngModel)]="itemDetalle.actaRecibida"
              name="actaRecibida"
            />
            <label class="form-check-label fw-semibold" for="actaRecibida">
              ¿Acta recibida?
            </label>
          </div>

          <div class="mb-3">
            <label class="form-label fw-semibold">Fecha de Recepción</label>
            <input
              type="date"
              class="form-control"
              [(ngModel)]="itemDetalle.fechaRecepcion"
              name="fechaRecepcion"
              required
            />
            <div class="invalid-feedback">Seleccione una fecha válida.</div>
          </div>
        </div>

        <!-- FOOTER -->
        <div class="modal-footer bg-white border-top">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Cancelar
          </button>
          <button type="submit" class="btn btn-primary">
            <i class="bi bi-save-fill me-2"></i> Guardar
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
